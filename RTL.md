# Cells

- FDCE

    - 带有时钟使能和异步清零的D触发器     
    - 当时钟使能（CE）为高并且异步清零信号 CLR 为低时，该 D 触发器将数据输入 D 端传递到输出 Q 端；当 CLR 为高时，不管输入是什么，输出 Q 端值都为0。       
    - 在数字电路设计中，D 触发器常用于存储数据、同步信号以及实现各种时序逻辑功能等。与其他类型的触发器相比，FDCE 的特点是具有异步清零功能，这意味着它可以在不受时钟信号同步的情况下，直接根据清零信号将输出置为 0。而时钟使能信号则可以控制触发器在何时接收数据输入并进行状态更新。

除了 FDCE 之外，还有一些类似的触发器，如：  
FDRE：带有时钟使能和同步清零的 D 触发器。   
FDPE：带有时钟使能和异步置位的 D 触发器。   
FDSE：带有时钟使能和同步置位的 D 触发器。

- IBUF

    - 输入缓冲器（input buffer）。在数字电路设计中，它通常用于对输入信号进行缓冲和增强驱动能力，以改善信号的质量和稳定性。
    - 输入缓冲器可以解决一些信号完整性问题，例如减少信号的反射、衰减和噪声干扰等。它能够提供一定的电流驱动能力，确保输入信号能够被后续电路正确地接收和处理。
    - 在 FPGA（现场可编程门阵列）设计中，ibuf 是一种常见的原语（primitive）。例如，Xilinx FPGA 中的 ibuf 原语一般会由 Vivado 等开发工具自动添加给输入信号，它可以保证输入信号的精准，有效解决颤抖、延迟等问题。另外，差分信号（包括差分时钟）进入片内之后如果不经过 ibufgds、ibufds 缓冲则无法直接处理。

- OBUF

- IOBUF

- BUFG

    - 全局时钟缓冲器      
    - BUFG的主要作用是对时钟信号进行缓冲和增强驱动能力，以减少时钟信号的传输延时和抖动，从而提高时钟信号的质量和稳定性。
    - 在Xilinx的FPGA中，与全局时钟资源相关的原语包括IBUFG（输入全局缓冲）、IBUFGDS（IBUFG的差分形式）、BUFG、BUFGCE（带有时钟使能端的全局缓冲）、BUFGP（相当于IBUFG加上BUFG）、BUFGCE、BUFGDLL（全局缓冲延迟锁相环）和DCM（数字时钟管理单元）等。     
    - BUFG的输入通常是IBUFG的输出，经过BUFG后的时钟信号到达FPGA内部的IOB（输入输出单元）、CLB（可配置逻辑块）、选择性块RAM（Block Select RAM）的时钟延迟和抖动最小。      
    - 当某个信号（如时钟、使能、快速路径等）的扇出非常大，并且要求抖动延迟最小时，可以使用BUFG驱动该信号，使该信号利用全局时钟资源。但需要注意的是，普通IO的输入或普通片内信号进入全局时钟布线层需要一个固有的延时，一般在10ns左右，即普通IO和普通片内信号从输入到BUFG输出有一个约10ns左右的固有延时，但是BUFG的输出到片内所有单元（如IOB、CLB、选择性块RAM）的延时可以忽略不计。     
    - 在FPGA设计中，正确使用全局时钟资源和相关原语对于实现高性能、稳定的时序逻辑至关重要。使用IBUFG或IBUFGDS的充分必要条件是信号从专用全局时钟管脚输入，否则在布局布线时会报错。这是由FPGA的内部结构决定的，因为IBUFG和IBUFGDS的输入端仅仅与芯片的专用全局时钟输入管脚有物理连接，与普通IO和其它内部CLB等没有物理连接。





# Vivado

## fsm_extraction(default : auto)

- one-hot

    - 对于最多 32 个状态的状态机，是默认的编码方案。      
    - 通常是优化速度或降低功耗的良好选择。        
    - 为每个 FSM 状态分配一个独特的代码位。       
    - 使用每个状态一个触发器来实现状态寄存器。    
    - 在操作期间的给定时钟周期内，状态寄存器中只有一位被置位。    
    - 在两个状态之间转换时，只有两位切换。
    ```
    星期日：1000000
    星期一：0100000
    星期二：0010000
    星期三：0001000
    星期四：0000100
    星期五：0000010
    星期六：0000001
    ```

- gray

    - 保证在两个连续状态之间只有一位切换。    
    - 适用于具有长路径且无分支的控制器。  
    - 最大限度地减少冒险和毛刺。  
    - 可用于最小化功耗。
    ```
    000 -> 001
    001 -> 011
    011 -> 010
    010 -> 110
    110 -> 111
    111 -> 101
    101 -> 100
    100 -> 000
    ```

- johnson

    - Johnson State Encoding（约翰逊编码）是一种状态编码方式，它与 Gray State Encoding（格雷码）的效果类似，适用于分支较少的状态机。  
    - 其码字生成原则为：初始时 n 位寄存器取值均为 0；然后取最高位（左边）的寄存器，在对其值取反后将其放在最低位（右边）的寄存器后，形成新的最低位；如此往复 2n+1 次，便得到所有 Johnson 码字。    
    例如，状态集合为{s0、s1、s2、s3、s4、s5}，共 6 个状态，那么若采用 Johnson 的编码方式，寄存器位宽应为 3，编码结果应该为：    
    ```
    s0 = 000；
    s1 = 001；
    s2 = 011；
    s3 = 111；
    s4 = 110；
    s5 = 100。
    ```
    通过上例可见，Johnson 编码后的两个相邻状态之间也仅有 1 位不同，这有利于消除当状态机在相邻状态间跳转时所产生的毛刺.  
    但与Gray 编码方式通常采用 n 位寄存器可表示 2^n 个状态不同，Johnson 编码方式通常采用 n 位寄存器表示 2n 个不同的状态。

- Sequential

    - 能够识别长路径：可以发现状态机中存在的较长路径。    
    - 对这些路径上的状态应用连续的二进制编码：即采用顺序的二进制数对每个状态进行编码。例如，将状态`state0`、`state1`、`state2`、`state3`分别表示为`00`、`01`、`10`、`11`。这种编码方式的优点是使用的状态向量位数最小。然而，其缺点是从一个状态转换到另一个状态时，可能会有多位比特位发生变化，从而产生中间态，瞬变次数多，容易引发毛刺并导致逻辑错误。    
    - 最小化下一个状态方程：通过这种编码方式，可以简化或优化状态机的下一个状态的确定方程或逻辑表达式，有助于减少逻辑电路的复杂性。




在实际应用中，需要根据具体的状态机设计需求和电路特性，综合考虑选择合适的编码方式。例如，如果对状态机的速度要求较高，且状态数量相对较少，可能会更倾向于使用独热编码；而格雷码编码则适用于减少毛刺和暂态的可能性等情况。


# Diff

- Vivado中会在[project summary]中显示各种基本信息以及综合结果（使用的cell种类及数量、使用率等），有多种表示形式     
    hqfpga中只能通过表格或查看文件形式进行分析

- Vivado可以在综合时选择fsm_extraction等选项
    hqfpga只能选择是否启用fsm优化

- Vivado可以生成时钟网络报告(report clock networks)     
  时钟网络反映了时钟从时钟引脚进入 FPGA 后在 FPGA 内部的传播路径。通过该报告可以查看设计中时钟树的树视图，每个时钟树会显示从源到端点的时钟网络，端点按类型排序。

- Vivado可以生成设计规则检查(report drc)    
  DRC 是确保设计符合特定制造工艺和设计要求的重要步骤。DRC 报告将列出设计中违反设计规则的情况，例如线宽不符合要求、间距过小、过孔数量或位置不正确等。

- Vivado可以保存多个不同的runs，可以自由切换    
    hqfpga只能使用当前的设置

- Vivado可以查看原理图，并查看每一个cell/net/pin/port等各种属性 
    hqfpga只能查看布局

- Vivado可以多个不同窗口随意组合/浮动   
    hqfpga窗口位置不能自由设置
    
- Vivado/hqfpga都可以执行命令行命令
    


# Others

## Hamming-3 encoding
    
    Hamming-3 encoding 通常指的是汉明码（Hamming Code）。汉明码是一种广泛应用于通信和存储系统中的错误纠正码，由理查德·卫斯里·汉明于 1950 年发明。       
    汉明码的主要作用是检测并纠正数据在传输或存储过程中可能发生的错误。它通过在原始数据中添加一定数量的冗余位（校验位）来实现纠错功能。      
    假设需要传输的数据信息是由位二进制位组成，通过公式计算得出至少需要位冗余位，那么整个信息流就有个二进制位。其中，所有的幂次位（1， 2， 4， 8...）作为奇偶校验位，其余的位为数据位。      
    汉明码规定，把索引的二进制形式从右往左（低位往高位）数，第几位是“”的索引所对应的十进制索引，其上面的数据位和该位“奇偶校验位”构成一组。      
    在编码时，根据特定规则填充奇偶校验位。而在接收端，可以通过重新计算校验位并与接收到的校验位进行比较，来检测和纠正错误。      
    汉明码不仅可以检测数据是否有效，还能在数据出错的情况下指明错误位置。汉明码只能发现和修正一位错误，对于两位或者两位以上的错误可能无法正确检测和发现。        
    例如，要对 7 位数据位进行汉明码编码，计算得出至少需要 4 位冗余位，整个信息流有 11 位。其中第 1、2、4、8 位为奇偶校验位，其他 7 位为数据位。假设需要传输的 7 位数据为 1011001，填充奇偶校验位（采用奇校验）后，总的汉明码为：1001101011。    
    汉明码具有较强的纠错能力，在数据传输和存储中可以提高数据的可靠性。其实现原理相对复杂，但通过精心设计的编码和校验规则，能够有效地检测和纠正单个位的错误，在通信领域等具有重要的应用价值。

## Hamming instance

    汉明距离是以理查德·卫斯里·汉明的名字命名的，它指的是两个等长的符号串之间对应符号不同的位置个数。    
    例如，有两组二进制数据，一组为 101，另一组为 111，那么把第一组的第二位数据 0 改成 1 就可以变成第二组数据 111，所以两组数据的汉明距离就为 1。汉明距离可以用来衡量两张图片的差异、比较两个字符串的相似度等，汉明距离越小，则代表相似度越高；汉明距离为 0，即代表两者完全一样。    
    在实际应用中，汉明距离常用于信息论、编码理论、密码学、图像处理等领域。例如在图像处理中，可通过汉明距离来比较二进制图像的差异；在一些搜索算法或相似性检测中，也会用到汉明距离来判断图片或其他数据的相似程度。

## RTL综合时的可扩展性   

- 逻辑规模的可扩展性
    
    当设计中的逻辑单元数量增加时，综合工具能够有效地处理并生成优化的结果，而不会出现显著的性能下降或资源利用效率降低。例如，在添加更多的功能模块或增加数据处理宽度时，综合过程仍能高效进行。

- 模块复用性
    
    已有的设计模块能够方便地在新的设计中被重复使用和集成，并且不会因为新的上下文环境而产生问题。

- 设计层次的可扩展性
    
    随着设计的复杂度增加，能够方便地添加新的层次结构，并且不同层次之间的接口和交互能够保持清晰和稳定。

- 时钟频率的可扩展性
    
    当设计规模或功能增加时，仍然能够通过适当的优化达到或接近原有的时钟频率要求，或者能够相对容易地调整时钟策略以适应新的规模。

- 技术和工艺的可扩展性
    
    当技术更新或工艺改进时，例如从一个更小的制程节点切换到一个更新的制程节点，RTL 设计能够相对容易地适应新的技术要求，而不需要进行大规模的重新设计。

- 资源类型的可扩展性
    
    当需要使用更多类型的资源（如不同类型的存储单元、特殊功能模块等）时，综合工具能够有效地将这些新资源纳入设计，并进行合理的优化和分配。

    例如，一个初始设计包含了一定数量的算术逻辑单元，当需要扩展功能以处理更多数据时，可扩展性好的设计能够轻松地添加更多同类单元，并且综合过程能够自动优化布线和资源分配，使得扩展后的设计依然能够高效运行。 


# Translate

### FSM组件

- **Vivado合成特性**：
    - 对同步有限状态机（FSM）组件具有特定的推断能力。
    - 内置FSM编码策略，以满足优化目标。
    - FSM提取默认启用。
    - 使用`-fsm_extraction off`可禁用FSM提取。

- **FSM描述**：
    - Vivado合成支持在摩尔（Moore）和米利（Mealy）形式下对有限状态机（FSM）的规范。FSM由以下部分组成：
        - 状态寄存器。
        - 下一个状态函数。
        - 输出函数。

- **FSM图**：
    - 以下图展示了一个包含Mealy和Moore机器的FSM表示，其中“Inputs Function”表示输入函数，“Next State”表示下一个状态，“RESET”表示复位，“CLOCK”表示时钟，“Register State”表示状态寄存器，“State Function”表示状态函数，“Outputs”表示输出，“Only for Mealy Machine”表示仅用于Mealy机器。

- **FSM寄存器**：
    - 为Vivado合成指定一个复位或上电状态，以识别有限状态机（FSM），或设置`FSM_ENCODING`为“none”。
    - 状态寄存器可以异步或同步复位到特定状态。

- **推荐使用同步复位逻辑**：
    - 相比于异步复位逻辑，使用同步复位逻辑对于FSM更为推荐。

- **自动状态编码**：
    - 当`FSM_ENCODING`设置为“auto”时，Vivado合成会尝试为给定的FSM选择最合适的编码方法。

- **One-Hot状态编码**：
    - 是状态机最多32个状态时的默认编码方案。
    - 通常是优化速度或降低功耗的良好选择。
    - 为FSM的每个状态分配一个独特的位码。
    - 用一个触发器（flip-flop）实现状态寄存器的每个状态。
    - 在操作的给定时钟周期内，状态寄存器中只有一位被断言。
    - 两个状态之间的转换仅涉及两位的切换。

- **Gray状态编码**：
    - 保证两个连续状态之间只有一位切换。
    - 适用于控制器具有长路径且无分支的情况。
    - 最小化冒险和毛刺。
    - 可用于最小化功耗。

- **Johnson状态编码**：
    - 在使用状态机包含长路径且无分支（如Gray状态编码）时是有益的。

- **Sequential状态编码**：
    - 识别长路径。
    - 对这些路径上的连续状态应用连续的基数为2的代码。
    - 最小化下一个状态方程。

- **FSM示例（Verilog）**：
    - **文件名**：`fsm_1.v`
    - **代码功能**：该模块`fsm_1`包含一个时钟`clk`、一个复位`reset`、一个标志`flag`和一个输出`sm_out`。状态机根据`flag`的值在不同状态之间转换。

- **FSM示例（VHDL）**：
    - **文件名**：`fsm_1.vhd`
    - **代码功能**：该实体`fsm_1`包含时钟`clk`、复位`reset`、标志`flag`作为输入，`sm_out`作为输出。根据时钟上升沿和复位信号，状态机在不同状态之间转换，并根据状态确定输出`sm_out`的值。

- **FSM报告**：
    - Vivado合成在日志文件中标记INFO消息，提供有关FSM组件及其编码的信息。例如：`INFO: [Synth 8 - 802] inferred FSM for state register 'tate_reg' in module 'fsm_test'`表示在模块`fsm_test`中为状态寄存器`state_reg`推断出FSM；`INFO: [Synth 8 - 3354] encoded FSM with state register 'tate_reg' using encoding 'equential' in module 'fsm_test'`表示在模块`fsm_test`中使用“sequential”编码对状态寄存器`state_reg`的FSM进行编码。

